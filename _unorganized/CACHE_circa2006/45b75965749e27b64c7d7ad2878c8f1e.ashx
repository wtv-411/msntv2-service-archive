var sBaseUrls; var iRotateDuration; var sCurrentlyLoadingUrl = "";var iCurrentBaseUrlIndex = 0;var sLoadedUrls = "|";var sNextUrlParams = "";var sPanelUrls = new Array();var sRotationArray;var iRotationIndex = -1;var oMasterPanel;var oCurrentPanel;var iRotateTimerID = null;function InitRotator(masterDivId, delayDuration, urls){oMasterPanel = masterDivId;iRotateDuration = delayDuration;sBaseUrls = urls;oCurrentPanel = oMasterPanel.children(0);var ctUrl = GetClickThroughUrl(oCurrentPanel.innerHTML);oCurrentPanel.clickThroughUrl = ctUrl;}function LoadRotator(){if (oMasterPanel != null)CreateNextPanel();}function ClickRotator(){var url = oCurrentPanel.clickThroughUrl;if (url != null && url.length > 0)location.href = oCurrentPanel.clickThroughUrl;}function CreateNextPanel(){var url = GetNextUrlToLoad();if (url != ""){sLoadedUrls = sLoadedUrls + url + "|";GetUrlData(url);}else{CreatesRotationArray();if (sRotationArray.length > 0)StartRotate();}}function GetNextUrlToLoad(){if (iCurrentBaseUrlIndex >= sBaseUrls.length)return "";var url = sBaseUrls[iCurrentBaseUrlIndex];if (sNextUrlParams != ""){var spacerChar = url.indexOf("?") > -1 ? "&" : "?";url = url + spacerChar + sNextUrlParams;sNextUrlParams = "";}if (sLoadedUrls.indexOf("|" + url + "|") != -1){iCurrentBaseUrlIndex = iCurrentBaseUrlIndex+1;return GetNextUrlToLoad();}else{return url;}}function GetUrlData(url){sCurrentlyLoadingUrl = url;XmlHttp = new ActiveXObject("Microsoft.XMLHTTP");XmlHttp.open("GET", url, true);XmlHttp.onreadystatechange = GetUrlCallback;XmlHttp.send(null);}function GetUrlCallback(){if (XmlHttp.readyState==4) {var responseText = XmlHttp.responseText;var feedbackStart = responseText.indexOf("<ROTATOR_FEEDBACK>");var feedbackEnd = responseText.indexOf("</ROTATOR_FEEDBACK>");var feedbackString = "";if ((feedbackStart!=-1) && (feedbackEnd!=-1)){feedbackString = responseText.substring(feedbackStart,feedbackEnd);feedbackString = feedbackString.substring(feedbackString.indexOf(">")+1);}var ctUrl = GetClickThroughUrl(responseText);if ((feedbackString != "NODISPLAY") && (ctUrl != "")){var panel = AddPanel();panel.style.display = "none";panel.innerHTML = responseText;panel.id = sCurrentlyLoadingUrl;panel.clickThroughUrl = ctUrl;sPanelUrls[sPanelUrls.length] = sCurrentlyLoadingUrl;sNextUrlParams = feedbackString;}CreateNextPanel();}}function AddPanel(){var newPanel = document.createElement("DIV");return oMasterPanel.appendChild(newPanel);}function GetClickThroughUrl(html){var ctUrlStart = html.indexOf("<ROTATOR_CLICKTHROUGH>");var ctUrlEnd = html.indexOf("</ROTATOR_CLICKTHROUGH>");var ctUrl = "";if ((ctUrlStart!=-1) && (ctUrlEnd!=-1)){ctUrl = html.substring(ctUrlStart,ctUrlEnd);ctUrl = ctUrl.substring(ctUrl.indexOf(">")+1);}return ctUrl;}function CreatesRotationArray(){var subrotations;var rotationCount = 1;var validBaseUrlCount = 0;var validsBaseUrls = new Array();for (var i=0; i<sBaseUrls.length; i++){subrotations = 0;for (var j=0; j<sPanelUrls.length; j++){if (sPanelUrls[j].indexOf(sBaseUrls[i])>-1){subrotations++;}}if (subrotations > 0){rotationCount *= subrotations;validsBaseUrls[validBaseUrlCount++] = sBaseUrls[i];}}rotationCount *= validBaseUrlCount;sRotationArray = new Array(rotationCount);for (var a=0; a<validBaseUrlCount; a++){var nowBaseUrl = validsBaseUrls[a];var allSubRotations = GetAllSubRotations(nowBaseUrl, sPanelUrls);for (var b=0; b<rotationCount; b+=validBaseUrlCount){var nowInd = a + b;if (b==0)sRotationArray[nowInd] = allSubRotations[0];else{var lastSubrotation = sRotationArray[a + b - validBaseUrlCount];sRotationArray[nowInd] = GetNextSubrotation(allSubRotations, lastSubrotation);}}}}function GetAllSubRotations(baseUrl, sPanelUrls){var subUrls = new Array();var j = 0;for (var i=0; i<sPanelUrls.length; i++){if (sPanelUrls[i].indexOf(baseUrl)!=-1)subUrls[j++] = sPanelUrls[i];}return subUrls;}function GetNextSubrotation(subrotations, lastSubrotation){for (var i=0; i<subrotations.length; i++){if (lastSubrotation==subrotations[i]){if (i==subrotations.length-1)return subrotations[0];elsereturn subrotations[i+1];}}return "";}function StartRotate(){iRotateTimerID = window.setTimeout(Rotate, iRotateDuration);}function StopRotate(){window.clearTimeout(iRotateTimerID);}function Rotate(){StopRotate();oCurrentPanel.style.display = "none";if (iRotationIndex == sRotationArray.length-1)iRotationIndex=0;elseiRotationIndex++;oCurrentPanel = document.getElementById(sRotationArray[iRotationIndex]);oCurrentPanel.style.display = "block";if (sRotationArray.length > 1)StartRotate();}var monthArray = new Array("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec");var clockRefreshMS = 1000;function constructDateTime(){now = new Date();var hours = now.getHours();var minutes = now.getMinutes();var minutesStr = "";var ampm = (hours >= 12) ? "PM":"AM";if (hours > 12) hours -= 12;if (hours == 0) hours = 12;if (minutes < 10){minutesStr = "0" + minutes;}else{minutesStr = minutes;}return monthArray[now.getMonth()] + " " + now.getDate()+ ", " + now.getYear();}function formClockLink(){return "<a id='clockLinkID' href='http://encarta.msn.com/encnet/features/onthisday.aspx' class='clockLink'>" + constructDateTime() + "</a>";}function showClock(){clockID.innerHTML = formClockLink();}function AssignClockEvents(){clockID.onmouseover = StopClock;clockID.onmouseout = StartClock;}function StopClock(){window.clearInterval(clockTimerID);}var clockTimerID = 0;function StartClock(){clockTimerID = window.setInterval(showClock, clockRefreshMS);}var pageLoaded = false;function onLoadProcess(){pageLoaded = true;}function initPage(){onLoadProcess();LoadRotator();AssignClockEvents();StartClock();}