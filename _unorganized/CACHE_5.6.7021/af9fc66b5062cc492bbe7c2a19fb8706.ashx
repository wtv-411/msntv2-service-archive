function Utils(){this.AddDiv = _utAddDiv;this.AddImg = _utAddImg;this.AddSpan = _utAddSpan;this.AddMarquee = _utAddMarquee;this.GetAppLoc = _utGetAppLoc;this.ImageTag = _utImageTag;this.ParseSeconds = _utParseSeconds;this.GetLargeImgUrl = _utGetLargeImgUrl;this.GetCookie = _utGetCookie;this.SetCookie = _utSetCookie;this.GetTimeStr = _utGetTimeStr;this.GetDateStr = _utGetDateStr;}function _utGetAppLoc(){var a = location.href;var b = a.substring(0,a.indexOf('://')+3);var c = a.substring(b.length, a.length);var d = c.substring(0,c.indexOf('/'));return b + d;}function _utAddSpan(ob){var newSpan = document.createElement("SPAN");return ob.appendChild(newSpan);}function _utAddDiv(ob){var newDiv = document.createElement("DIV");return ob.appendChild(newDiv);}function _utAddMarquee(ob, behav, dir, truSpd){var tag = document.createElement("MARQUEE");var newOb = ob.appendChild(tag);newOb.behavior = behav;newOb.direction = dir;newOb.trueSpeed = truSpd;return newOb;}function _utAddImg(ob){var newImg = document.createElement("IMG");return ob.appendChild(newImg);}function _utParseSeconds(sec){var mm = Math.floor(sec/60);var ss = sec - mm*60;if (mm == -1)return "00:00";elsereturn ((mm < 10) ? "0" + mm : mm) + ":" + ((ss < 10) ? "0" + ss : ss);}function _utImageTag(src, w, h, className){var tag = "<img src='" + src + "'";if (w!="")tag += " width='" + w + "'";if (h!="")tag += " height='" + h + "'";if (className!="")tag += " class='" + className + "'";tag += "/>";return tag; }function _utGetLargeImgUrl(url){var i = url.indexOf(".vmod.jpg");if (i != -1){url = url.substring(0,i) + ".hlarge.jpg";}return url;}function _utGetCookie(name){var dc = document.cookie;var prefix = name + "=";var begin = dc.indexOf("; " + prefix);if (begin == -1){begin = dc.indexOf(prefix);if (begin != 0) return null;}else{begin += 2;}var end = document.cookie.indexOf(";", begin);if (end == -1){end = dc.length;}return unescape(dc.substring(begin + prefix.length, end));}function _utSetCookie(name, value, expires, path, domain, secure){document.cookie= name + "=" + escape(value) +((expires) ? "; expires=" + expires.toGMTString() : "") +((path) ? "; path=" + path : "") +((domain) ? "; domain=" + domain : "") +((secure) ? "; secure" : "");}function _utGetTimeStr(){var d = new Date();var dt = d.toTimeString();return dt.substring(0,5);}function _utGetDateStr(){var d = new Date();var ds = d.toDateString();return ds.substring(0,3) + ", " + ds.substring(4,10);}function DataFetcher(){this.Init = _dfInit;this.GetData = _dfGetData;this.OnLoad = _dfOnLoad;}function _dfInit(){this.DomDoc = new ActiveXObject("Msxml2.DOMDocument");this.DomDoc.onreadystatechange = _dfCheckReadyState;this.DomDoc.async = true;}function _dfGetData(url, onSucceed, onFail){this.OnSucceed = onSucceed;this.OnFail = onFail;this.DomDoc.load(url);}function _dfCheckReadyState(){if (oDataFetcher.DomDoc.readyState==4) {oDataFetcher.OnLoad();}}function _dfOnLoad(){this.Data = this.DomDoc.text;if (this.DomDoc.parseError.errorCode != 0 || this.Data==""){this.OnFail.call();}else{this.OnSucceed.call();}}function PromoStage(container, flourish, mainDiv, div0, div1, div2, errorDiv){this.Container = container;this.Flourish = flourish;this.MainDiv = mainDiv;this.Div0 = div0;this.Div1 = div1;this.Div2 = div2;this.ErrorDiv = errorDiv;this.Init = _psInit;this.Load = _psLoad;this.ShowFlourish = _psShowFlourish;this.ShowPromos = _psShowPromos;this.ShowError = _psShowError;this.Over = _psOver;this.Off = _psOff;this.ShowDefaultImg = _psShowDefaultImg;}function _psInit(){this.ImgDivs = new Array();this.CropTxt = new Array();this.Marquee = new Array();this.Guids = new Array();for (var i=0; i<3; i++){var div = eval("this.Div" + i);this.ImgDivs[i] = oUtils.AddDiv(div);this.ImgDivs[i].className = "psImgDiv";this.CropTxt[i] = oUtils.AddDiv(div);this.CropTxt[i].className = "psCropTxt";this.Marquee[i] = oUtils.AddMarquee(div, "scroll", "left", "true");this.Marquee[i].className = "psMarquee";}}function _psShowFlourish(){this.Flourish.style.display = "block"; vdPrmFlrsh.Play();}function _psShowPromos(){if (gFadeEnabled)this.Container.filters[0].apply();this.Flourish.style.display = "none"; this.MainDiv.style.display = "inline"; if (gFadeEnabled)this.Container.filters[0].play();}function _psShowError(msg){this.Flourish.style.display = "none"; this.MainDiv.style.display = "none"; this.ErrorDiv.style.display = "block"; this.ErrorDiv.innerHTML = "Sorry. Video is currently unavailable.";for (var i=0; i<3; i++){this.ImgDivs[i].innerHTML = "";this.CropTxt[i].innerHTML = "";this.Marquee[i].innerHTML = "";var div = eval("this.Div"+i);div.style.display = "none";}}function _psLoad(guidArray, imgSrcArray, captionArray){for (var i=0; i<3; i++){this.Guids[i] = guidArray[i];this.ImgDivs[i].innerHTML = "<img class=\"psImg\" onError=\"oPromoStage.ShowDefaultImg(this)\" src=\"" + oUtils.GetLargeImgUrl(imgSrcArray[i])+ "\" />";this.CropTxt[i].innerHTML = captionArray[i];this.Marquee[i].innerHTML = captionArray[i];var div = eval("this.Div"+i);div.style.display = "block";this.Marquee[i].stop();this.CropTxt[i].style.display = "block";}}function _psOver(i){this.CropTxt[i].style.display = "none";this.Marquee[i].style.display = "block";this.Marquee[i].start();this.NowScrolling = i;}function _psOff(i){this.Marquee[i].stop();this.Marquee[i].style.display = "none";this.CropTxt[i].style.display = "block";}function _psShowDefaultImg(img){img.src = "/Images/HomeBB/defaultVideoPromo.jpg";img.className = "psImgDflt";}function Debugger(div){this.Div = div;this.Init = _dbInit;this.Append = _dbAppend;this.Overwrite = _dbOverwrite;}function _dbInit(){this.Text1 = oUtils.AddSpan(this.Div);this.Text1.className = "dbgTxt dbgTxt1";}function _dbAppend(html){this.Text1.innerHTML += html + "<br/>";}function _dbOverwrite(html){this.Text1.innerHTML = html;}function Rotator(div, nextSpan){this.Div = div;this.NextSpan = nextSpan;this.Init = _roInit;this.Start = _roStart;this.ShowInd = _roShowInd;this.Show = _roShow;this.Hide = _roHide;this.Rotate = _roRotate;this.Click = _roClick;}function _roInit(types, counts, labels, intervalMls){this.Interval = intervalMls;var rotations = new Array();var panelLabels = new Array();var counters = new Array();for (var i=0; i<types.length; i++){counters[i] = 1;} do{var allDone = true;for (var i=0; i<types.length; i++){rotations[rotations.length] = types[i] + counters[i];panelLabels[panelLabels.length] = labels[i];if (counters[i] == counts[i]){counters[i] = 1;}else{counters[i] = counters[i]+1;allDone = false;}}}while (allDone == false)this.Rotations = rotations;this.PanelLabels = panelLabels;}function _roStart(){this.Rotate();}function _roShowInd(showInd, transition){if (this.Rotations.length == 0)return;if (transition && gFadeEnabled)this.Div.filters[0].apply();if (this.NowInd != null)document.all[this.Rotations[this.NowInd]].style.display = "none";document.all[this.Rotations[showInd]].style.display = "inline";if (transition && gFadeEnabled)this.Div.filters[0].play();this.NowInd = showInd;var nextInd = (showInd+1 == this.Rotations.length) ? 0 : showInd+1;this.NextSpan.innerText = "NEXT" + this.PanelLabels[nextInd];}function _roHide(){this.Div.style.display = "none";window.clearTimeout(this.Timer);}function _roShow(){this.Div.style.display = "block";}function _roRotate(){window.clearTimeout(this.Timer);var nextInd = (this.NowInd+1 == this.Rotations.length) ? 0 : this.NowInd+1;this.ShowInd(nextInd, true);this.Timer = window.setTimeout(function() {oRotator.Rotate()}, this.Interval);}function _roClick(){try{var f = eval(this.Rotations[this.NowInd] + "URL");eval(f);}catch (error){}}var gAppLoc;var gLocalTime;var gLocalDateStr;var gFadeEnabled = (2.5999999999999996>= 1.2);var promoDataHasLoaded = false;var flourishIsDone = false;var flourishTimer;var promoError;var oUtils;var oDataFetcher;var oPromoStage;var oRotator;function init(){var rotatorInterval = 15000;oUtils = new Utils();oDataFetcher = new DataFetcher();oPromoStage = new PromoStage(psContainer, psFlourish, psMainDiv, psDiv0, psDiv1, psDiv2, psErrorDiv);oRotator = new Rotator(rotatorDiv, rotatorNextText);gAppLoc = oUtils.GetAppLoc();gLocalDateStr = oUtils.GetDateStr();gLocalTime = oUtils.GetTimeStr();day.innerHTML = gLocalDateStr;day.style.display = "inline";oDataFetcher.Init();oPromoStage.Init();oRotator.Init(rotationTypes, rotationCounts, rotationLabels, rotatorInterval); var url = "/VideoContent.ashx?contentType=userPlaylist&feature=homepagevideo&time=" + gLocalTime + "&excludeGuids=" + rotatorGuids;oDataFetcher.GetData(url, onLoadVideoPromos, onLoadPromosFail);oRotator.ShowInd(0, true);oRotator.Timer = window.setTimeout(function(){oRotator.Start()}, rotatorInterval);var ck = "bbhomeflourish";if (oUtils.GetCookie(ck) == null){oPromoStage.ShowFlourish();oUtils.SetCookie(ck, "done");}else{flourishIsDone = true; tryShowPromos("");}zydecoMessage();}function getCookie(c_name){var c_value = document.cookie;var c_start = c_value.indexOf(" " + c_name + "=");if (c_start == -1){c_start = c_value.indexOf(c_name + "=");}if (c_start == -1){c_value = null;}else{c_start = c_value.indexOf("=", c_start) + 1;var c_end = c_value.indexOf(";", c_start);if (c_end == -1){c_end = c_value.length;}c_value = unescape(c_value.substring(c_start,c_end));}return c_value;}function setZydecoCookie(value){var exdate=new Date();exdate.setDate(exdate.getDate() + 100);var c_value=escape(value) + "; expires="+exdate.toUTCString();document.cookie="zydeco=" + c_value;}function zydecoMessage(){var zydecoCookie=getCookie("zydeco");var msg = "The MSN TV 2 service will be closing on September 30, 2013."+" You should receive an email and letter providing more information."+" Please read the Closure FAQ for details on what"+" you should do before the service ends.";if (zydecoCookie == null){if(window.external.MessageBox(msg, "Important Message", "Cancel;Closure FAQ", 1, 0x30, 0)){window.location.href ="http://www.msntv.com/msntv2/ClosureFAQ.asp";}var zydecoCount = 1;setZydecoCookie(zydecoCount);}}function clickSlide(ind){var guids = oPromoStage.Guids;if (guids != null)toVideoApp(guids[ind], guids);}function clickRotatorVideo(guid){var guidstr = rotatorGuids.substring(1,rotatorGuids.length-1);var guids = guidstr.split('|');toVideoApp(guid, guids);}function toVideoApp(firstGuid, allGuids){var s = firstGuid;for (var i=0; i<allGuids.length; i++){if (allGuids[i]!=firstGuid){s += "," + allGuids[i];}}location.href = "/Pages/MSNVideo/Main.aspx?i=" + s;}function overSlide(i){oPromoStage.Over(i);}function offSlide(i){oPromoStage.Off(i);}function clickNext(){oRotator.Rotate();}function onLoadVideoPromos(){promoDataHasLoaded = true;try{eval(oDataFetcher.Data);if (g_scGuids.length > 2){oPromoStage.Load(g_scGuids, g_scImageUrls, g_scHeadlines);}else{promoError = "0";}}catch (error){promoError = "1";}tryShowPromos();}function onLoadPromosFail(){promoDataHasLoaded = true;promoError = "2";tryShowPromos();}function tryShowPromos(){if (promoDataHasLoaded && flourishIsDone){if (promoError != null)oPromoStage.ShowError(promoError);elseoPromoStage.ShowPromos();}}function onFlourishEvent(command, args){switch (command){case "endFlourish":flourishIsDone = true; tryShowPromos(); break;}}function handleLoopingDivReady(){}var gScriptLoaded = true;